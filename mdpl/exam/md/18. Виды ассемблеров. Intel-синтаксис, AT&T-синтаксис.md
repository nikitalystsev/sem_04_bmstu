# 19. Подпрограммы. Объявление, вызов.

---

Процедурой в ассемблере является все то, что в других языках называют подпрограммами, функциями, процедурами и т. д. Ассемблер не накладывает на процедуры никаких ограничений - на любой адрес программы можно передать управление командой CALL, и оно вернется к вызвавшей процедуре, как только встретится команда RET. Такая свобода выражения легко может приводить к труд- . нечитаемым программам, и в язык ассемблера были включены директивы логического оформления процедур.



**Подпрограмма** - именованная часть программы.

**Пример объявления подпрограммы:**

```assembly
MyProc proc near ; указываем тип перехода
    ...
Myproc endp
```



### CALL <операнд >

---

Сохраняет текущий адрес в стеке и передает управление по адресу, указанному в операнде. Операндом может быть непосредственное значение адреса (метка в ассемблерных программах), регистр или переменная, содержащие адрес перехода. Если в качестве адреса перехода указано только смещение, считается, что адрес расположен в том же сегменте, что и команда CALL. При этом, так же как и в случае с JMP, выполняется ближний вызов процедуры. Процессор помещает значение регистра EIP (IP при 16-битной адресации), соответствующее следующей за CALL команде, в стек и загружает в EIP новое значение, осуществляя тем самым передачу управления. Если операнд CALL - регистр или переменная, то его значение рассматривается как абсолютное смещение, если операнд - ближняя метка в программе, то ассемблер указывает ее относительное смещение. Чтобы выполнить дальний CALL в реальном режиме, режиме V86 или в защищенном режиме при переходе в сегмент с теми же привилегиями, процессор помещает в стек значения регистров CS и EIP (IP при 16-битной адресации) и осуществляет дальний переход аналогично команде JMP.



Перед вызовом подпрограммы вызывающая программа кладёт в стек параметры, затем выполняет команду CALL, подпрограмма сама в своём начале сохраняет текущее значение регистра SP в регистре BP и дополнительно уменьшает SP на размер области памяти, необходимый для хранения локальных переменных.



Если подпрограмма использует стек для хранения локальных переменных, ESP изменится, но ЕВР можно будет использовать для того, чтобы считывать Значения параметров напрямую из стека.

![image-20230614233647648](C:\Users\nikitalystsev\AppData\Roaming\Typora\typora-user-images\image-20230614233647648.png)

![image-20230614233700310](C:\Users\nikitalystsev\AppData\Roaming\Typora\typora-user-images\image-20230614233700310.png)