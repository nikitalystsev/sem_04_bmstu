# 30. Расширения процессора. MMX. Регистры, поддерживаемые типы данных.

---

Начиная с модификации процессора Pentium P54C, все процессоры Intel содержат расширение ММХ, предназначенное для увеличения эффективности программ, работающих с большими потоками данных (обработка изображений, звука, видео, синтез), то есть для всех тех случаев, когда нужно выполнить несложные операции над массивами однотипных чисел. ММХ предоставляет несколько новых типов данных, регистров и команд, позволяющих осуществлять арифметические и логические операции над несколькими числами одновременно. 

### Регистры ММХ

---

Расширение ММХ включает в себя восемь 64-битных регистров общего пользования ММО - ММ7. Физически никаких новых регистров с введением ММХ не появилось, ММО - ММ7 - это в точности мантиссы восьми регистров FPU, от RO до R7.При записи числа в регистр ММХ оно оказывается в битах 63-0 соответствующего регистра FPU, а экспонента (биты 78-64) и ее знаковый бит (бит 79) заполняются единицами.

Запись числа в регистр FPU также приводит к изменению соответствующего регистра ММХ. Любая команда ММХ, кроме EMMS, приводит к тому, что поле ТОР регистра SR и весь регистр TW в FPU обнуляются. Команда EMMS заполняет регистр TW единицами. 

Таким образом, нельзя одновременно пользоваться командами FPU и командами ММХ, а если это необходимо - следует применять команды `FSAVE/FRSTOR` каждый раз перед переходом от FPU к ММХ и обратно (эти команды сохраняют состояние регистров ММХ точно так же, как и FPU).

![image-20230614191259496](C:\Users\nikitalystsev\AppData\Roaming\Typora\typora-user-images\image-20230614191259496.png)



### Типы данных ММХ 

ММХ использует четыре новых типа данных: 

1. учетверенное слово — простое 64-битное число; 
2. упакованные двойные слова - два 32-битных двойных слова, упакованные в 64-битный тип данных. Двойное слово 1 занимает биты 63—32, и двойное слово 0 - биты 31-0; 
3. упакованные слова - четыре 16-битных слова, упакованные в 64-битный тип данных. Слово 3 занимает биты 63-48, слово 0 - биты 15-0; 
4. упакованные байты - восемь байт, упакованных в 64-битный тип данных. Байт 7 занимает биты 63-56, байт 0 - биты 7-0



Команды ММХ перемещают упакованные данные в память или в обычные регистры как целое, но выполняют арифметические и логические операции над каждым элементом по отдельности. Арифметические операции в ММХ могут использовать специальный способ обработки переполнений и антипереполнений - __насыщение__. Если результат операции больше, чем максимальное значение для его типа данных (+127 для байта со знаком), то результат подразумевают равным этому максимальному значению. 

Если он меньше минимального значения - соответственно его считают равным минимально допустимому значению. 

Например, при операциях с цветом насыщение позволяет ему превращаться в чисто белый при переполнении и в чисто черный при антипереполнении, в то время как обычная арифметика привела бы к нежелательной инверсии цвета.